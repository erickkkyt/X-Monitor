# X API v2 限制与计划分析 (针对 twitter-monitor-cron 功能)

本文档梳理了 `twitter-monitor-cron` 功能在调用 X API v2 时可能遇到的主要限制，特别是获取用户推文时间线 (`GET /2/users/:id/tweets`) 的限制，并结合了不同访问级别的计划信息。

**核心 API 调用:** `GET /2/users/:id/tweets` (通过 `twitterApi.userTimeline`)
**认证方式:** OAuth 2.0 Bearer Token
**适用限制类型:** **PER APP** (每个应用)

---

## 各访问级别限制与计划

### 1. Free (免费版)

*   **价格:** 免费
*   **主要限制:**
    *   **请求速率限制 (`GET /2/users/:id/tweets`):** **1 次请求 / 15 分钟 (PER APP)**
    *   **月度推文获取量:** 最多获取 100 条推文 / 月
    *   **月度推文写入量:** 最多 500 条推文 / 月 (与读取无关)
*   **应用环境:** 1 个

**Implications:** 15 分钟内只能对所有监控账号总共发起 1 次 `userTimeline` 调用。如果监控超过 1 个账号或执行频率高于 15 分钟，**极易触发 429 错误**。同时，每月只能获取 100 条推文，对于活跃账号监控基本不可行。

### 2. Basic (基础版)

*   **价格:**
    *   $175 / 月 (按年付费，有限时优惠)
    *   $200 / 月 (按月付费)
*   **主要限制:**
    *   **请求速率限制 (`GET /2/users/:id/tweets`):** **15 次请求 / 15 分钟 (PER APP)**
    *   **月度推文获取量:** 最多获取 15,000 条推文 / 月
    *   **用户相关请求:** 50,000 次请求 / 月 (可能是指 User context，但获取量限制可能先达到)
*   **应用环境:** 2 个
*   **实时流:** 无访问权限

**Implications:** 15 分钟内允许的总调用次数增加到 15 次。如果监控的账号数量少于 15 个，并且执行频率控制在 1 分钟以上一次（理论上），有可能避免 429。但如果监控账号较多或执行频率较高（如每 5 分钟），仍然可能触发 429。月度获取 15k 推文是一个额外的限制。

### 3. Pro (专业版)

*   **价格:**
    *   $4500 / 月 (按年付费)
    *   $5000 / 月 (按月付费)
*   **主要限制:**
    *   **请求速率限制 (`GET /2/users/:id/tweets`):** **450 次请求 / 15 分钟 (PER APP)**
    *   **月度推文获取量:** 最多获取 1,000,000 条推文 / 月
    *   **用户相关请求:** 超过 8,000,000 次请求 / 月
*   **应用环境:** 3 个
*   **实时流:** 有访问权限

**Implications:** 速率限制大幅提高，15 分钟内允许 450 次 `userTimeline` 调用，足以支持监控相当数量的账号或更高的执行频率。月度获取 1M 推文是主要的量级限制。

---

## 总结与分析

*   **当前遇到的 429 错误** 是因为函数在 15 分钟内调用 `GET /2/users/:id/tweets` 的总次数超过了你当前访问级别（很可能是 Free 或 Basic）的 **请求速率限制**。
*   **Free 级别限制极低 (1次/15分钟)**，几乎无法满足多账号监控的需求。
*   **Basic 级别 (15次/15分钟)** 有所改善，但仍需谨慎控制执行频率和监控账号数量。
*   **Pro 级别 (450次/15分钟)** 则宽松得多。
*   除了请求速率限制，还需要关注**月度推文获取量**的限制 (Free: 100, Basic: 15k, Pro: 1M)，如果监控的账号非常活跃，即使请求次数没超标，也可能因为获取的总推文数超标而受限（API 可能返回不同错误或无数据）。

**解决 429 错误的建议:**

1.  **降低执行频率:** 将 Supabase Cron Job 的执行间隔调整为更长，例如 15 分钟或更久，以匹配或低于你的速率限制。
2.  **升级访问级别:** 根据你的监控需求（账号数量、期望的更新频率）选择合适的付费级别 (Basic 或 Pro)。
3.  **(可选) 实现请求间隔:** 在代码中循环处理账号时加入延迟。

---
*信息来源: [X API Rate Limits Documentation](https://docs.x.com/resources/fundamentals/rate-limits) (该页面链接到 v2 具体限制) 及开发者门户截图。*
